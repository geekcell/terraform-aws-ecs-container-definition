<!-- BEGIN_TF_DOCS -->
[![Geek Cell GmbH](https://raw.githubusercontent.com/geekcell/.github/main/geekcell-github-banner.png)](https://www.geekcell.io/)

### Code Quality
[![License](https://img.shields.io/github/license/geekcell/terraform-aws-ecs-container-definition)](https://github.com/geekcell/terraform-aws-ecs-container-definition/blob/master/LICENSE)
[![GitHub release (latest tag)](https://img.shields.io/github/v/release/geekcell/terraform-aws-ecs-container-definition?logo=github&sort=semver)](https://github.com/geekcell/terraform-aws-ecs-container-definition/releases)
[![Release](https://github.com/geekcell/terraform-aws-ecs-container-definition/actions/workflows/release.yaml/badge.svg)](https://github.com/geekcell/terraform-aws-ecs-container-definition/actions/workflows/release.yaml)
[![Validate](https://github.com/geekcell/terraform-aws-ecs-container-definition/actions/workflows/validate.yaml/badge.svg)](https://github.com/geekcell/terraform-aws-ecs-container-definition/actions/workflows/validate.yaml)
[![Lint](https://github.com/geekcell/terraform-aws-ecs-container-definition/actions/workflows/linter.yaml/badge.svg)](https://github.com/geekcell/terraform-aws-ecs-container-definition/actions/workflows/linter.yaml)

### Security
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/general)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=INFRASTRUCTURE+SECURITY)

#### Cloud
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_aws)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+AWS+V1.2)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_aws_13)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+AWS+V1.3)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_azure)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+AZURE+V1.1)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_azure_13)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+AZURE+V1.3)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_gcp)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+GCP+V1.1)

##### Container
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_kubernetes_16)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+KUBERNETES+V1.6)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_eks_11)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+EKS+V1.1)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_gke_11)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+GKE+V1.1)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/cis_kubernetes)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=CIS+KUBERNETES+V1.5)

#### Data protection
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/soc2)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=SOC2)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/pci)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=PCI-DSS+V3.2)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/pci_dss_v321)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=PCI-DSS+V3.2.1)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/iso)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=ISO27001)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/nist)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=NIST-800-53)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/hipaa)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=HIPAA)
[![Infrastructure Tests](https://www.bridgecrew.cloud/badges/github/geekcell/terraform-aws-ecs-container-definition/fedramp_moderate)](https://www.bridgecrew.cloud/link/badge?vcs=github&fullRepo=geekcell%2Fterraform-aws-ecs-container-definition&benchmark=FEDRAMP+%28MODERATE%29)

# Terraform AWS ECS Container Definition

This module is used to generate a container definition for use in an AWS ECS task definition.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_command"></a> [command](#input\_command) | The command that is passed to the container. | `list(string)` | `null` | no |
| <a name="input_cpu"></a> [cpu](#input\_cpu) | The number of cpu units reserved for the container. | `number` | `0` | no |
| <a name="input_depend_on"></a> [depend\_on](#input\_depend\_on) | The dependencies defined for container startup and shutdown. | `map(string)` | `{}` | no |
| <a name="input_disable_networking"></a> [disable\_networking](#input\_disable\_networking) | When this parameter is true, networking is disabled within the container. | `bool` | `null` | no |
| <a name="input_dns_search_domains"></a> [dns\_search\_domains](#input\_dns\_search\_domains) | A list of DNS search domains that are presented to the container. | `list(string)` | `null` | no |
| <a name="input_dns_servers"></a> [dns\_servers](#input\_dns\_servers) | A list of DNS servers that are presented to the container. | `list(string)` | `null` | no |
| <a name="input_docker_labels"></a> [docker\_labels](#input\_docker\_labels) | A key/value map of labels to add to the container. | `map(string)` | `null` | no |
| <a name="input_docker_security_options"></a> [docker\_security\_options](#input\_docker\_security\_options) | A list of strings to provide custom labels for SELinux and AppArmor multi-level security systems. | `list(string)` | `null` | no |
| <a name="input_entrypoint"></a> [entrypoint](#input\_entrypoint) | The entry point that is passed to the container. | `list(string)` | `null` | no |
| <a name="input_environment"></a> [environment](#input\_environment) | The environment variables to pass to a container. | `map(string)` | `{}` | no |
| <a name="input_environment_files"></a> [environment\_files](#input\_environment\_files) | The environment files to pass to a container. | `list(string)` | `[]` | no |
| <a name="input_essential"></a> [essential](#input\_essential) | Whether this container is essential to the task. If the container fails or stops for any reason, all other containers that are part of the task are stopped. | `bool` | `true` | no |
| <a name="input_extra_hosts"></a> [extra\_hosts](#input\_extra\_hosts) | A list of hostnames and IP address mappings to append to the /etc/hosts file on the container. | `map(string)` | `{}` | no |
| <a name="input_firelens_configuration"></a> [firelens\_configuration](#input\_firelens\_configuration) | The FireLens configuration for the container. | <pre>object({<br>    type    = string<br>    options = optional(map(string))<br>  })</pre> | `null` | no |
| <a name="input_healthcheck"></a> [healthcheck](#input\_healthcheck) | The container health check command and associated configuration parameters for the container. | <pre>object({<br>    command      = list(string)<br>    interval     = optional(number)<br>    retries      = optional(number)<br>    start_period = optional(number)<br>    timeout      = optional(number)<br>  })</pre> | `null` | no |
| <a name="input_hostname"></a> [hostname](#input\_hostname) | The hostname to use for your container. | `string` | `null` | no |
| <a name="input_image"></a> [image](#input\_image) | The image used to start the container. | `string` | n/a | yes |
| <a name="input_interactive"></a> [interactive](#input\_interactive) | When this parameter is true, the container is given read-only access to its root file system. | `bool` | `null` | no |
| <a name="input_links"></a> [links](#input\_links) | Links to other containers. | `list(string)` | `null` | no |
| <a name="input_linux_parameters"></a> [linux\_parameters](#input\_linux\_parameters) | Linux-specific modifications that are applied to the container, such as Linux kernel capabilities. | <pre>object({<br>    init_process_enabled = optional(bool)<br><br>    shared_memory_size = optional(number)<br>    max_swap           = optional(number)<br>    swappiness         = optional(number)<br><br>    capabilities = optional(object({<br>      add  = optional(list(string))<br>      drop = optional(list(string))<br>    }))<br><br>    devices = optional(list(object({<br>      host_path      = string<br>      container_path = optional(string)<br>      permissions    = optional(list(string))<br>    })), [])<br><br>    tmpfs = optional(list(object({<br>      container_path = string<br>      size           = number<br>      mount_options  = optional(list(string))<br>    })), [])<br>  })</pre> | `null` | no |
| <a name="input_log_configuration"></a> [log\_configuration](#input\_log\_configuration) | The log configuration specification for the container. | <pre>object({<br>    log_driver     = optional(string)<br>    options        = optional(map(string))<br>    secret_options = optional(map(string))<br>  })</pre> | `null` | no |
| <a name="input_memory"></a> [memory](#input\_memory) | The hard limit (in MiB) of memory to present to the container. | `number` | `null` | no |
| <a name="input_memory_reservation"></a> [memory\_reservation](#input\_memory\_reservation) | The soft limit (in MiB) of memory to reserve for the container. | `number` | `null` | no |
| <a name="input_mount_points"></a> [mount\_points](#input\_mount\_points) | The mount points for data volumes in your container. | <pre>list(object({<br>    source_volume  = string<br>    container_path = string<br>    read_only      = optional(bool, false)<br>  }))</pre> | `[]` | no |
| <a name="input_name"></a> [name](#input\_name) | The name of the container. | `string` | n/a | yes |
| <a name="input_port_mappings"></a> [port\_mappings](#input\_port\_mappings) | The list of port mappings for the container. | <pre>list(object({<br>    app_protocol         = optional(string)<br>    container_port_range = optional(string)<br><br>    container_port = optional(number)<br>    host_port      = optional(number)<br>    protocol       = optional(string, "tcp")<br>  }))</pre> | `[]` | no |
| <a name="input_privileged"></a> [privileged](#input\_privileged) | When this parameter is true, the container is given elevated privileges on the host container instance (similar to the root user). | `bool` | `null` | no |
| <a name="input_pseudo_terminal"></a> [pseudo\_terminal](#input\_pseudo\_terminal) | When this parameter is true, a TTY is allocated. | `bool` | `null` | no |
| <a name="input_readonly_root_filesystem"></a> [readonly\_root\_filesystem](#input\_readonly\_root\_filesystem) | When this parameter is true, the container is given read-only access to its root file system. | `bool` | `null` | no |
| <a name="input_repository_credentials"></a> [repository\_credentials](#input\_repository\_credentials) | The private repository authentication credentials to use. | `string` | `null` | no |
| <a name="input_resource_requirements"></a> [resource\_requirements](#input\_resource\_requirements) | The type and amount of a resource to assign to a container. | `map(string)` | `{}` | no |
| <a name="input_secrets"></a> [secrets](#input\_secrets) | The secrets to pass to the container. | `map(string)` | `{}` | no |
| <a name="input_start_timeout"></a> [start\_timeout](#input\_start\_timeout) | Time duration (in seconds) to wait before giving up on resolving dependencies for a container. | `number` | `null` | no |
| <a name="input_stop_timeout"></a> [stop\_timeout](#input\_stop\_timeout) | Time duration (in seconds) to wait before the container is forcefully killed if it doesn't exit normally on its own. | `number` | `null` | no |
| <a name="input_system_controls"></a> [system\_controls](#input\_system\_controls) | A list of namespaced kernel parameters to set in the container. | `map(string)` | `{}` | no |
| <a name="input_ulimits"></a> [ulimits](#input\_ulimits) | A list of ulimits to set in the container. | <pre>map(object({<br>    hard_limit = number<br>    soft_limit = number<br>  }))</pre> | `{}` | no |
| <a name="input_user"></a> [user](#input\_user) | The user to use inside the container. | `string` | `null` | no |
| <a name="input_volumes_from"></a> [volumes\_from](#input\_volumes\_from) | Data volumes to mount from another container. | <pre>map(object({<br>    read_only = optional(bool, false)<br>  }))</pre> | `{}` | no |
| <a name="input_working_directory"></a> [working\_directory](#input\_working\_directory) | The working directory in which to run commands inside the container. | `string` | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_hcl"></a> [hcl](#output\_hcl) | Rendered container definition as HCL object. |
| <a name="output_json"></a> [json](#output\_json) | Rendered container definition as JSON output. |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_jq"></a> [jq](#provider\_jq) | 0.2.1 |

## Resources

- data source.jq_query.main (main.tf#114)

# Examples
### Min
```hcl
module "basic-example" {
  source = "../../"

  name  = var.name
  image = "nginx:1.23-alpine"
}
```

### Full
```hcl
module "full" {
  source = "../../"

  name      = var.name
  image     = "nginx:latest"
  essential = true

  command    = ["sleep", "1000"]
  entrypoint = ["/bin/sh", "-c"]
  user       = "root"

  interactive     = false
  pseudo_terminal = false

  cpu                = 256
  memory             = 512
  memory_reservation = 1024

  working_directory        = "/tmp"
  readonly_root_filesystem = true

  port_mappings = [
    {
      container_port = 80
      host_port      = 80
      protocol       = "tcp"
    },
    {
      container_port = 443
      host_port      = 443
      protocol       = "tcp"
    }
  ]

  links = ["app"]
  mount_points = [
    {
      container_path = "/tmp"
      source_volume  = "tmp"
      read_only      = false
    }
  ]
  volumes_from = {
    app = { read_only = true }
  }

  dns_search_domains = ["example.com"]
  dns_servers        = ["10.0.0.1"]

  hostname = "nginx"
  extra_hosts = {
    "local.host" = "127.0.0.1"
    "loopback"   = "127.0.0.1"
  }

  privileged         = true
  disable_networking = false
  ulimits = {
    nofile = {
      soft_limit = 1024
      hard_limit = 2048
    }
    nproc = {
      soft_limit = 1024
      hard_limit = 2048
    }
  }

  docker_security_options = ["label:type:container_t"]
  system_controls = {
    "net.ipv4.tcp_syncookies" = 1
    "net.core.somaxconn"      = 1024
  }

  linux_parameters = {
    init_process_enabled = true

    shared_memory_size = 1024
    max_swap           = 1024
    swappiness         = 50

    capabilities = {
      add  = ["SYS_TIME"]
      drop = ["MKNOD"]
    }

    devices = [
      {
        host_path      = "/dev/null"
        container_path = "/dev/null"
        permissions    = ["read", "write"]
      }
    ]

    tmpfs = [
      {
        size           = 1024
        container_path = "/tmp"
        mount_options  = ["rw", "noexec", "nosuid", "nodev"]
      }
    ]
  }

  environment_files = ["s3://bucket/key/to/file.env"]
  environment = {
    APP_ENV   = "dev"
    APP_DEBUG = false
  }

  secrets = {
    DATABASE_USER = "arn:aws:ssm:us-east-1:awsExampleAccountID:parameter/awsExampleParameter:DB_PASS::"
    APP_SECRET    = "arn:aws:ssm:us-east-1:awsExampleAccountID:parameter/awsExampleParameter:APP_SECRET::"
  }

  docker_labels = {
    "com.example.foo" = "bar"
    "com.example.baz" = "qux"
  }

  start_timeout = 60
  stop_timeout  = 60
  depend_on = {
    redis = "HEALTHY"
  }
  healthcheck = {
    command      = ["CMD-SHELL", "curl -f http://localhost/ || exit 1"]
    interval     = 30
    retries      = 3
    start_period = 0
    timeout      = 5
  }

  resource_requirements = {
    GPU                  = 256
    InferenceAccelerator = "eia1.medium"
  }

  repository_credentials = "arn:aws:ssm:us-east-1:awsExampleAccountID:parameter/awsExampleParameter"

  log_configuration = {
    log_driver = "awsfirelens"
    options = {
      endpoint = "https://example.com"
    }
    secret_options = {
      apiKey = "arn:aws:ssm:us-east-1:awsExampleAccountID:parameter/awsExampleParameter:apiKey::"
    }
  }
}
```
<!-- END_TF_DOCS -->
